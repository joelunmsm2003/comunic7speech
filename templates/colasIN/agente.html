{% extends 'base.html' %}



  {% block content %}



<script type="text/javascript" src="/static/ws4.js"></script>

<script type="text/javascript">

     var ws4redis = WS4Redis({
      uri: '{{ WEBSOCKET_URI }}foobar?subscribe-user',
      receive_message: receiveMessage,
      heartbeat_msg: {{ WS4REDIS_HEARTBEAT }}
    });

    function receiveMessage(msg) {

        console.log(msg.split('-')[0])

          if(msg.split('-')[0]=='llamada'){



              window.location.href = "/colasIN/monitor_agente/"+msg.split('-')[1]+'/0'

      
        }
       

    }


    function nuevaventa(url){

        var strWindowFeatures = "location=yes,height=700,width=800,scrollbars=yes,status=yes";
        var URL = url ;
        var win = window.open(URL, "_blank", strWindowFeatures);


    }

       function nuevocaso(url){

        var strWindowFeatures = "location=yes,height=700,width=500,scrollbars=yes,status=yes";
        var URL = url ;
        var win = window.open(URL+'?telefono='+'{{llamada_entrante}}', "_blank", strWindowFeatures);

        console.log('{{llamada_entrante}}')


        }


</script>



<div style='height: 20px'></div>
<div class='container-fluid'>


  <div class='discador'>


    <img src='/static/callcenter.png'>

    
    
    <h6>{{agente.nombre}} </h6>



    <div style="height:20px;"></div>

  
    
    {% if agente.estado.nombre == 'Pausa' or agente.estado.nombre == 'Disponible'   %}

    <div style="padding:20px;">

      {% if agente.estado.nombre == 'Pausa' %}

      <a class='btn btn-primary' href='/colasIN/disponible/{{agente.id}}'>
          Disponible
      </a>

      {% endif %}

       {% if agente.estado.nombre == 'Disponible' %}




        <a class='btn btn-primary' href='/colasIN/pausar/{{agente.id}}'>
        Pausar
        </a>

      {% endif %}

    </div>

     
      

    {% else %}

    

    <img src='/static/llamada.png'>
    <br>

    <h6>En Llamada</h6>

    

   <br>


  
    
    {% endif %}

    <a class="btn btn-primary" href='/comunica7/ingresar'>Salir</a>


  </div>


  <style>


    .cajita{
      background: #fff;
      padding: 6px;
      color: #234;border:1px solid #234;
      margin-bottom: 10px;
    }

      .discador{
    
        position: absolute;
        top: 0px;
        right: 0px;
        background: #1086fb;
        transition:all .5s;
        height: 300px;
        z-index: 1000;
        width:120px;
        padding-top: 20px;
       
        color:#fff;
        text-align: center;
    }
    
      
      .discador:hover{
    
        position: absolute;
        top: 0px;
        background: #1086fb;
        transition:all .5s;
        width:140px;
        
    }

    .discador img{

      width: 40px;

      cursor:pointer;
    }

   

    .discador:hover .cajita{

    
    border: 1px solid #1086fb;


    }
    
    
    
      
    </style>

      


     
      <h6>Estado Actual </h6>
      <h4>{{agente.estado.nombre}}</h4>


      
    {% if llamada_entrante == '0' %}



    {% else %}

    <h6>Llamada entrante... {{llamada_entrante}}</h6>

    
    {% endif %}



          <div class="btn-group" role="group" aria-label="Basic example">
           <!-- Button trigger modal -->
           <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
              Buscar Incidencia
            </button>

            <a onclick="nuevocaso('/colasIN/nuevo_caso')" target="_blank"  class="btn btn-secondary" style='color:#fff;'>Crear Nueva Incidencia</a>
            <a href='/colasIN/monitor_agente/0/0/'   class="btn btn-dark" style='color:#fff;'>Mostrar Todas las Incidencias</a>


          </div>

          <div style='height:20px;'></div>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                     
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Ingrese Datos de Busqueda</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <form method='GET' action='/colasIN/monitor_agente/0/0'>
                      <div class="modal-body">

                              {% for hidden in form.hidden_fields %}
                              {{ hidden }}
                              {% endfor %}
                              <div class='row'>
                              {% for field in reportefiltro.visible_fields %}
                            
                              
                              <div class="col-md-4">
                                    
                                        {{ field.errors }}
                                        {{ field.label_tag }} {{ field }}
                                </div>
                              
                                {% endfor %}
                             
                              </div>
                            
                            
                                
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                        <button  type="submit" class="btn btn-primary" >Buscar</button>
                      </div>
      
                      </form>
                  </div>
                </div>


  </div>

</div>

<div class='container-fluid'>

    {% if historial_llamada %}

  

    <h5>Historial de incidencias con el numero {{llamada_entrante}}</h5>

    <table class="table table-default responsive">
        <thead>
          <tr>
          
            <th scope="col">Numero Caso</th>
            <th scope="col">Tipo Caso</th>
            <th scope="col">Sub Tipo Caso</th>
            <th scope="col">Estado</th>
           
            <th scope="col">Subestado</th>
            <th scope="col">Detalles del Lugar</th>
            <th scope="col">Fechas de Notificacion</th>
            <th scope="col">Unidad Reportante</th>
            <th scope="col">Dispositivo Origen</th>
            <th scope="col">Reportante</th>
            <th>Zona</th>
            <th>Accion Tomada</th>
            <th>Situacion</th>
          </tr>
        </thead>
        <tbody>
    
    
    
          {% for c in historial_llamada %}
          <tr>
           
          
            <td>{{c.id }}</td>
            <td>{{c.tipo_caso }}</td>
            <td>{{c.sub_tipo_caso}}</td>
            <td>{{c.estado_incidencia.nombre}}</td>
            <td>{{c.subestado.nombre}}</td>
            
            <td>{{c.detalle_lugar}}</td>
            <td>{{c.fecha_atencion}}</td>
            <td>{{c.unidad_reportante}}</td>
            <td>{{c.dispositivo_origen}}</td>
            <td>{{c.telefono_1}}</td>
            <td>{{c.zona}}</td>
            <td>{{c.accion_tomada}}</td>
            <td>{{c.situacion}}</td>
            <td>
            <div class='row'>
              
            
            <div class='col-md-6'> <a class='btn btn-sm btn-light' onclick="nuevaventa('/colasIN/detalle_venta/{{c.id}}')" target="_blank">Detalle</a></div>
            <div class='col-md-6'> <a class='btn btn-sm btn-light' onclick="nuevaventa('/colasIN/nueva_venta/{{c.id}}')" target="_blank">Nueva</a></td></div>
           
            
            </div>
          </tr>
    
          {% endfor %}
    
        </tbody>
      </table>
    
      
    {% endif %}

{% include "colasIN/gestion.html" %}

</div>

  {% endblock %}